(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict'

module.exports = {
    'positions': [
        // Row 1
        -900, -900, 0,
        -300, -900, 0,
        -900, -300, 0,
        -900, -300, 0,
        -300, -900, 0,
        -300, -300, 0,

        -300, -900, 0,
        300, -900, 0,
        -300, -300, 0,
        -300, -300, 0,
        300, -900, 0,
        300, -300, 0,

        300, -900, 0,
        900, -900, 0,
        300, -300, 0,
        300, -300, 0,
        900, -900, 0,
        900, -300, 0,

        // Row 2
        -900, -300, 0,
        -300, -300, 0,
        -900, 300, 0,
        -900, 300, 0,
        -300, -300, 0,
        -300, 300, 0,

        -300, -300, 0,
        300, -300, 0,
        -300, 300, 0,
        -300, 300, 0,
        300, -300, 0,
        300, 300, 0,

        300, -300, 0,
        900, -300, 0,
        300, 300, 0,
        300, 300, 0,
        900, -300, 0,
        900, 300, 0,

        // Row 3
        -900, 300, 0,
        -300, 300, 0,
        -900, 900, 0,
        -900, 900, 0,
        -300, 300, 0,
        -300, 900, 0,

        -300, 300, 0,
        300, 300, 0,
        -300, 900, 0,
        -300, 900, 0,
        300, 300, 0,
        300, 900, 0,

        300, 300, 0,
        900, 300, 0,
        300, 900, 0,
        300, 900, 0,
        900, 300, 0,
        900, 900, 0],

    'colors': [
        // Row 1
        10, 10, 10,
        10, 10, 10,
        10, 10, 10,
        10, 10, 10,
        10, 10, 10,
        10, 10, 10,

        40, 40, 40,
        40, 40, 40,
        40, 40, 40,
        40, 40, 40,
        40, 40, 40,
        40, 40, 40,

        70, 70, 70,
        70, 70, 70,
        70, 70, 70,
        70, 70, 70,
        70, 70, 70,
        70, 70, 70,

        // Row 2
        100, 100, 100,
        100, 100, 100,
        100, 100, 100,
        100, 100, 100,
        100, 100, 100,
        100, 100, 100,

        130, 130, 130,
        130, 130, 130,
        130, 130, 130,
        130, 130, 130,
        130, 130, 130,
        130, 130, 130,

        160, 160, 160,
        160, 160, 160,
        160, 160, 160,
        160, 160, 160,
        160, 160, 160,
        160, 160, 160,

        // Row 3
        190, 190, 190,
        190, 190, 190,
        190, 190, 190,
        190, 190, 190,
        190, 190, 190,
        190, 190, 190,

        220, 220, 220,
        220, 220, 220,
        220, 220, 220,
        220, 220, 220,
        220, 220, 220,
        220, 220, 220,

        250, 250, 250,
        250, 250, 250,
        250, 250, 250,
        250, 250, 250,
        250, 250, 250,
        250, 250, 250]
};
},{}],2:[function(require,module,exports){
"use strict"

var tileData = require('./data/tiledata.js');

$(function () {
    main();
});

var main = function () {
    // Get A WebGL context
    var canvas = document.getElementById("canvas");
    var gl = getWebGLContext(canvas);
    if (!gl) {
        return;
    }

    // setup GLSL program
    var program = createProgramFromScripts(gl, ["2d-vertex-shader", "2d-fragment-shader"]);
    gl.useProgram(program);

    // look up where the vertex data needs to go.
    var positionLocation = gl.getAttribLocation(program, "a_position");
    var colorLocation = gl.getAttribLocation(program, "a_color");

    // lookup uniforms
    var modelViewMatrixLocation = gl.getUniformLocation(program, "u_modelViewMatrix");
    var projectionMatrixLocation = gl.getUniformLocation(program, "u_projectionMatrix");

    // Create a buffer.
    var buffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
    gl.enableVertexAttribArray(positionLocation);
    gl.vertexAttribPointer(positionLocation, 3, gl.FLOAT, false, 0, 0);

    setTiles(gl);

    // Create a buffer for colors.
    var buffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
    gl.enableVertexAttribArray(colorLocation);
    gl.vertexAttribPointer(colorLocation, 3, gl.UNSIGNED_BYTE, true, 0, 0);

    // Set Colors.
    setColors(gl);

    var fov = Math.PI / 3;
    var translation = [0, 0, -1000];
    var rotation = [0, 0, 0];

    // Setup a ui.
    $("#fov").gmanSlider({ value: radToDeg(fov), slide: updateFov, min: 1, max: 179 });
    $("#x").gmanSlider({ slide: updateTranslation(0), min: -canvas.width, max: canvas.width });
    $("#y").gmanSlider({ slide: updateTranslation(1), min: -canvas.height, max: canvas.height });
    $("#z").gmanSlider({ value: translation[2], slide: updateTranslation(2), min: -10000, max: -2 });
    $("#pitch").gmanSlider({ slide: updateRotation(0), max: 90 });
    $("#bearing").gmanSlider({ slide: updateRotation(2), max: 360 });

    function updateFov(event, ui) {
        fov = degToRad(ui.value);
        drawScene();
    }

    function updateTranslation(index) {
        return function (event, ui) {
            translation[index] = ui.value;
            drawScene();
        }
    }

    function updateRotation(index) {
        return function (event, ui) {
            rotation[index] = degToRad(ui.value);
            drawScene();
        }
    }

    function radToDeg(r) {
        return r * 180 / Math.PI;
    }

    function degToRad(d) {
        return d * Math.PI / 180;
    }

    // Draw a the scene.
    function drawScene() {
        // Clear the canvas.
        gl.clear(gl.COLOR_BUFFER_BIT);

        var aspect = canvas.clientWidth / canvas.clientHeight;

        var mv = new Float32Array(16);
        mat4.fromTranslation(mv, [0, 0, translation[2]]);
        mat4.rotateX(mv, mv, -rotation[0]);
        mat4.rotateZ(mv, mv, rotation[2]);
        mat4.translate(mv, mv, [-translation[0], translation[1], 0]);

        var s = new Float32Array(16);
        mat4.fromScaling(s, [-1, 1, 1]);
        mat4.mul(mv, s, mv);

        gl.uniformMatrix4fv(modelViewMatrixLocation, false, mv);

        var p = new Float32Array(16);
        mat4.perspective(p, fov, aspect, 1, 11000);
        gl.uniformMatrix4fv(projectionMatrixLocation, false, p);

        // Draw the rectangle.
        gl.drawArrays(gl.TRIANGLES, 0, 9 * 6);
    }

    function setColors(gl, value) {

        gl.bufferData(
            gl.ARRAY_BUFFER,
            new Uint8Array(tileData.colors),
            gl.STATIC_DRAW);
    }

    // Fill the buffer with the values that define a rectangle.
    function setTiles(gl) {
        gl.bufferData(
            gl.ARRAY_BUFFER,
            new Float32Array(tileData.positions),
            gl.STATIC_DRAW);
    }

    drawScene()
}
},{"./data/tiledata.js":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImphdmFzY3JpcHQvZGF0YS90aWxlZGF0YS5qcyIsImphdmFzY3JpcHQvcGl0Y2guanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiJ3VzZSBzdHJpY3QnXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgICdwb3NpdGlvbnMnOiBbXG4gICAgICAgIC8vIFJvdyAxXG4gICAgICAgIC05MDAsIC05MDAsIDAsXG4gICAgICAgIC0zMDAsIC05MDAsIDAsXG4gICAgICAgIC05MDAsIC0zMDAsIDAsXG4gICAgICAgIC05MDAsIC0zMDAsIDAsXG4gICAgICAgIC0zMDAsIC05MDAsIDAsXG4gICAgICAgIC0zMDAsIC0zMDAsIDAsXG5cbiAgICAgICAgLTMwMCwgLTkwMCwgMCxcbiAgICAgICAgMzAwLCAtOTAwLCAwLFxuICAgICAgICAtMzAwLCAtMzAwLCAwLFxuICAgICAgICAtMzAwLCAtMzAwLCAwLFxuICAgICAgICAzMDAsIC05MDAsIDAsXG4gICAgICAgIDMwMCwgLTMwMCwgMCxcblxuICAgICAgICAzMDAsIC05MDAsIDAsXG4gICAgICAgIDkwMCwgLTkwMCwgMCxcbiAgICAgICAgMzAwLCAtMzAwLCAwLFxuICAgICAgICAzMDAsIC0zMDAsIDAsXG4gICAgICAgIDkwMCwgLTkwMCwgMCxcbiAgICAgICAgOTAwLCAtMzAwLCAwLFxuXG4gICAgICAgIC8vIFJvdyAyXG4gICAgICAgIC05MDAsIC0zMDAsIDAsXG4gICAgICAgIC0zMDAsIC0zMDAsIDAsXG4gICAgICAgIC05MDAsIDMwMCwgMCxcbiAgICAgICAgLTkwMCwgMzAwLCAwLFxuICAgICAgICAtMzAwLCAtMzAwLCAwLFxuICAgICAgICAtMzAwLCAzMDAsIDAsXG5cbiAgICAgICAgLTMwMCwgLTMwMCwgMCxcbiAgICAgICAgMzAwLCAtMzAwLCAwLFxuICAgICAgICAtMzAwLCAzMDAsIDAsXG4gICAgICAgIC0zMDAsIDMwMCwgMCxcbiAgICAgICAgMzAwLCAtMzAwLCAwLFxuICAgICAgICAzMDAsIDMwMCwgMCxcblxuICAgICAgICAzMDAsIC0zMDAsIDAsXG4gICAgICAgIDkwMCwgLTMwMCwgMCxcbiAgICAgICAgMzAwLCAzMDAsIDAsXG4gICAgICAgIDMwMCwgMzAwLCAwLFxuICAgICAgICA5MDAsIC0zMDAsIDAsXG4gICAgICAgIDkwMCwgMzAwLCAwLFxuXG4gICAgICAgIC8vIFJvdyAzXG4gICAgICAgIC05MDAsIDMwMCwgMCxcbiAgICAgICAgLTMwMCwgMzAwLCAwLFxuICAgICAgICAtOTAwLCA5MDAsIDAsXG4gICAgICAgIC05MDAsIDkwMCwgMCxcbiAgICAgICAgLTMwMCwgMzAwLCAwLFxuICAgICAgICAtMzAwLCA5MDAsIDAsXG5cbiAgICAgICAgLTMwMCwgMzAwLCAwLFxuICAgICAgICAzMDAsIDMwMCwgMCxcbiAgICAgICAgLTMwMCwgOTAwLCAwLFxuICAgICAgICAtMzAwLCA5MDAsIDAsXG4gICAgICAgIDMwMCwgMzAwLCAwLFxuICAgICAgICAzMDAsIDkwMCwgMCxcblxuICAgICAgICAzMDAsIDMwMCwgMCxcbiAgICAgICAgOTAwLCAzMDAsIDAsXG4gICAgICAgIDMwMCwgOTAwLCAwLFxuICAgICAgICAzMDAsIDkwMCwgMCxcbiAgICAgICAgOTAwLCAzMDAsIDAsXG4gICAgICAgIDkwMCwgOTAwLCAwXSxcblxuICAgICdjb2xvcnMnOiBbXG4gICAgICAgIC8vIFJvdyAxXG4gICAgICAgIDEwLCAxMCwgMTAsXG4gICAgICAgIDEwLCAxMCwgMTAsXG4gICAgICAgIDEwLCAxMCwgMTAsXG4gICAgICAgIDEwLCAxMCwgMTAsXG4gICAgICAgIDEwLCAxMCwgMTAsXG4gICAgICAgIDEwLCAxMCwgMTAsXG5cbiAgICAgICAgNDAsIDQwLCA0MCxcbiAgICAgICAgNDAsIDQwLCA0MCxcbiAgICAgICAgNDAsIDQwLCA0MCxcbiAgICAgICAgNDAsIDQwLCA0MCxcbiAgICAgICAgNDAsIDQwLCA0MCxcbiAgICAgICAgNDAsIDQwLCA0MCxcblxuICAgICAgICA3MCwgNzAsIDcwLFxuICAgICAgICA3MCwgNzAsIDcwLFxuICAgICAgICA3MCwgNzAsIDcwLFxuICAgICAgICA3MCwgNzAsIDcwLFxuICAgICAgICA3MCwgNzAsIDcwLFxuICAgICAgICA3MCwgNzAsIDcwLFxuXG4gICAgICAgIC8vIFJvdyAyXG4gICAgICAgIDEwMCwgMTAwLCAxMDAsXG4gICAgICAgIDEwMCwgMTAwLCAxMDAsXG4gICAgICAgIDEwMCwgMTAwLCAxMDAsXG4gICAgICAgIDEwMCwgMTAwLCAxMDAsXG4gICAgICAgIDEwMCwgMTAwLCAxMDAsXG4gICAgICAgIDEwMCwgMTAwLCAxMDAsXG5cbiAgICAgICAgMTMwLCAxMzAsIDEzMCxcbiAgICAgICAgMTMwLCAxMzAsIDEzMCxcbiAgICAgICAgMTMwLCAxMzAsIDEzMCxcbiAgICAgICAgMTMwLCAxMzAsIDEzMCxcbiAgICAgICAgMTMwLCAxMzAsIDEzMCxcbiAgICAgICAgMTMwLCAxMzAsIDEzMCxcblxuICAgICAgICAxNjAsIDE2MCwgMTYwLFxuICAgICAgICAxNjAsIDE2MCwgMTYwLFxuICAgICAgICAxNjAsIDE2MCwgMTYwLFxuICAgICAgICAxNjAsIDE2MCwgMTYwLFxuICAgICAgICAxNjAsIDE2MCwgMTYwLFxuICAgICAgICAxNjAsIDE2MCwgMTYwLFxuXG4gICAgICAgIC8vIFJvdyAzXG4gICAgICAgIDE5MCwgMTkwLCAxOTAsXG4gICAgICAgIDE5MCwgMTkwLCAxOTAsXG4gICAgICAgIDE5MCwgMTkwLCAxOTAsXG4gICAgICAgIDE5MCwgMTkwLCAxOTAsXG4gICAgICAgIDE5MCwgMTkwLCAxOTAsXG4gICAgICAgIDE5MCwgMTkwLCAxOTAsXG5cbiAgICAgICAgMjIwLCAyMjAsIDIyMCxcbiAgICAgICAgMjIwLCAyMjAsIDIyMCxcbiAgICAgICAgMjIwLCAyMjAsIDIyMCxcbiAgICAgICAgMjIwLCAyMjAsIDIyMCxcbiAgICAgICAgMjIwLCAyMjAsIDIyMCxcbiAgICAgICAgMjIwLCAyMjAsIDIyMCxcblxuICAgICAgICAyNTAsIDI1MCwgMjUwLFxuICAgICAgICAyNTAsIDI1MCwgMjUwLFxuICAgICAgICAyNTAsIDI1MCwgMjUwLFxuICAgICAgICAyNTAsIDI1MCwgMjUwLFxuICAgICAgICAyNTAsIDI1MCwgMjUwLFxuICAgICAgICAyNTAsIDI1MCwgMjUwXVxufTsiLCJcInVzZSBzdHJpY3RcIlxuXG52YXIgdGlsZURhdGEgPSByZXF1aXJlKCcuL2RhdGEvdGlsZWRhdGEuanMnKTtcblxuJChmdW5jdGlvbiAoKSB7XG4gICAgbWFpbigpO1xufSk7XG5cbnZhciBtYWluID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIEdldCBBIFdlYkdMIGNvbnRleHRcbiAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjYW52YXNcIik7XG4gICAgdmFyIGdsID0gZ2V0V2ViR0xDb250ZXh0KGNhbnZhcyk7XG4gICAgaWYgKCFnbCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gc2V0dXAgR0xTTCBwcm9ncmFtXG4gICAgdmFyIHByb2dyYW0gPSBjcmVhdGVQcm9ncmFtRnJvbVNjcmlwdHMoZ2wsIFtcIjJkLXZlcnRleC1zaGFkZXJcIiwgXCIyZC1mcmFnbWVudC1zaGFkZXJcIl0pO1xuICAgIGdsLnVzZVByb2dyYW0ocHJvZ3JhbSk7XG5cbiAgICAvLyBsb29rIHVwIHdoZXJlIHRoZSB2ZXJ0ZXggZGF0YSBuZWVkcyB0byBnby5cbiAgICB2YXIgcG9zaXRpb25Mb2NhdGlvbiA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIFwiYV9wb3NpdGlvblwiKTtcbiAgICB2YXIgY29sb3JMb2NhdGlvbiA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIFwiYV9jb2xvclwiKTtcblxuICAgIC8vIGxvb2t1cCB1bmlmb3Jtc1xuICAgIHZhciBtb2RlbFZpZXdNYXRyaXhMb2NhdGlvbiA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBcInVfbW9kZWxWaWV3TWF0cml4XCIpO1xuICAgIHZhciBwcm9qZWN0aW9uTWF0cml4TG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgXCJ1X3Byb2plY3Rpb25NYXRyaXhcIik7XG5cbiAgICAvLyBDcmVhdGUgYSBidWZmZXIuXG4gICAgdmFyIGJ1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xuICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBidWZmZXIpO1xuICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHBvc2l0aW9uTG9jYXRpb24pO1xuICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIocG9zaXRpb25Mb2NhdGlvbiwgMywgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTtcblxuICAgIHNldFRpbGVzKGdsKTtcblxuICAgIC8vIENyZWF0ZSBhIGJ1ZmZlciBmb3IgY29sb3JzLlxuICAgIHZhciBidWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTtcbiAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgYnVmZmVyKTtcbiAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShjb2xvckxvY2F0aW9uKTtcbiAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKGNvbG9yTG9jYXRpb24sIDMsIGdsLlVOU0lHTkVEX0JZVEUsIHRydWUsIDAsIDApO1xuXG4gICAgLy8gU2V0IENvbG9ycy5cbiAgICBzZXRDb2xvcnMoZ2wpO1xuXG4gICAgdmFyIGZvdiA9IE1hdGguUEkgLyAzO1xuICAgIHZhciB0cmFuc2xhdGlvbiA9IFswLCAwLCAtMTAwMF07XG4gICAgdmFyIHJvdGF0aW9uID0gWzAsIDAsIDBdO1xuXG4gICAgLy8gU2V0dXAgYSB1aS5cbiAgICAkKFwiI2ZvdlwiKS5nbWFuU2xpZGVyKHsgdmFsdWU6IHJhZFRvRGVnKGZvdiksIHNsaWRlOiB1cGRhdGVGb3YsIG1pbjogMSwgbWF4OiAxNzkgfSk7XG4gICAgJChcIiN4XCIpLmdtYW5TbGlkZXIoeyBzbGlkZTogdXBkYXRlVHJhbnNsYXRpb24oMCksIG1pbjogLWNhbnZhcy53aWR0aCwgbWF4OiBjYW52YXMud2lkdGggfSk7XG4gICAgJChcIiN5XCIpLmdtYW5TbGlkZXIoeyBzbGlkZTogdXBkYXRlVHJhbnNsYXRpb24oMSksIG1pbjogLWNhbnZhcy5oZWlnaHQsIG1heDogY2FudmFzLmhlaWdodCB9KTtcbiAgICAkKFwiI3pcIikuZ21hblNsaWRlcih7IHZhbHVlOiB0cmFuc2xhdGlvblsyXSwgc2xpZGU6IHVwZGF0ZVRyYW5zbGF0aW9uKDIpLCBtaW46IC0xMDAwMCwgbWF4OiAtMiB9KTtcbiAgICAkKFwiI3BpdGNoXCIpLmdtYW5TbGlkZXIoeyBzbGlkZTogdXBkYXRlUm90YXRpb24oMCksIG1heDogOTAgfSk7XG4gICAgJChcIiNiZWFyaW5nXCIpLmdtYW5TbGlkZXIoeyBzbGlkZTogdXBkYXRlUm90YXRpb24oMiksIG1heDogMzYwIH0pO1xuXG4gICAgZnVuY3Rpb24gdXBkYXRlRm92KGV2ZW50LCB1aSkge1xuICAgICAgICBmb3YgPSBkZWdUb1JhZCh1aS52YWx1ZSk7XG4gICAgICAgIGRyYXdTY2VuZSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVwZGF0ZVRyYW5zbGF0aW9uKGluZGV4KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGlvbltpbmRleF0gPSB1aS52YWx1ZTtcbiAgICAgICAgICAgIGRyYXdTY2VuZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdXBkYXRlUm90YXRpb24oaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICAgICAgICAgIHJvdGF0aW9uW2luZGV4XSA9IGRlZ1RvUmFkKHVpLnZhbHVlKTtcbiAgICAgICAgICAgIGRyYXdTY2VuZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmFkVG9EZWcocikge1xuICAgICAgICByZXR1cm4gciAqIDE4MCAvIE1hdGguUEk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGVnVG9SYWQoZCkge1xuICAgICAgICByZXR1cm4gZCAqIE1hdGguUEkgLyAxODA7XG4gICAgfVxuXG4gICAgLy8gRHJhdyBhIHRoZSBzY2VuZS5cbiAgICBmdW5jdGlvbiBkcmF3U2NlbmUoKSB7XG4gICAgICAgIC8vIENsZWFyIHRoZSBjYW52YXMuXG4gICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQpO1xuXG4gICAgICAgIHZhciBhc3BlY3QgPSBjYW52YXMuY2xpZW50V2lkdGggLyBjYW52YXMuY2xpZW50SGVpZ2h0O1xuXG4gICAgICAgIHZhciBtdiA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpO1xuICAgICAgICBtYXQ0LmZyb21UcmFuc2xhdGlvbihtdiwgWzAsIDAsIHRyYW5zbGF0aW9uWzJdXSk7XG4gICAgICAgIG1hdDQucm90YXRlWChtdiwgbXYsIC1yb3RhdGlvblswXSk7XG4gICAgICAgIG1hdDQucm90YXRlWihtdiwgbXYsIHJvdGF0aW9uWzJdKTtcbiAgICAgICAgbWF0NC50cmFuc2xhdGUobXYsIG12LCBbLXRyYW5zbGF0aW9uWzBdLCB0cmFuc2xhdGlvblsxXSwgMF0pO1xuXG4gICAgICAgIHZhciBzID0gbmV3IEZsb2F0MzJBcnJheSgxNik7XG4gICAgICAgIG1hdDQuZnJvbVNjYWxpbmcocywgWy0xLCAxLCAxXSk7XG4gICAgICAgIG1hdDQubXVsKG12LCBzLCBtdik7XG5cbiAgICAgICAgZ2wudW5pZm9ybU1hdHJpeDRmdihtb2RlbFZpZXdNYXRyaXhMb2NhdGlvbiwgZmFsc2UsIG12KTtcblxuICAgICAgICB2YXIgcCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpO1xuICAgICAgICBtYXQ0LnBlcnNwZWN0aXZlKHAsIGZvdiwgYXNwZWN0LCAxLCAxMTAwMCk7XG4gICAgICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYocHJvamVjdGlvbk1hdHJpeExvY2F0aW9uLCBmYWxzZSwgcCk7XG5cbiAgICAgICAgLy8gRHJhdyB0aGUgcmVjdGFuZ2xlLlxuICAgICAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFUywgMCwgOSAqIDYpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldENvbG9ycyhnbCwgdmFsdWUpIHtcblxuICAgICAgICBnbC5idWZmZXJEYXRhKFxuICAgICAgICAgICAgZ2wuQVJSQVlfQlVGRkVSLFxuICAgICAgICAgICAgbmV3IFVpbnQ4QXJyYXkodGlsZURhdGEuY29sb3JzKSxcbiAgICAgICAgICAgIGdsLlNUQVRJQ19EUkFXKTtcbiAgICB9XG5cbiAgICAvLyBGaWxsIHRoZSBidWZmZXIgd2l0aCB0aGUgdmFsdWVzIHRoYXQgZGVmaW5lIGEgcmVjdGFuZ2xlLlxuICAgIGZ1bmN0aW9uIHNldFRpbGVzKGdsKSB7XG4gICAgICAgIGdsLmJ1ZmZlckRhdGEoXG4gICAgICAgICAgICBnbC5BUlJBWV9CVUZGRVIsXG4gICAgICAgICAgICBuZXcgRmxvYXQzMkFycmF5KHRpbGVEYXRhLnBvc2l0aW9ucyksXG4gICAgICAgICAgICBnbC5TVEFUSUNfRFJBVyk7XG4gICAgfVxuXG4gICAgZHJhd1NjZW5lKClcbn0iXX0=
